
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
			
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьПубликациюТоваров(Команда)
	
		ЕстьАктуальныеНастройки  = ЕстьАктуальныеНастройкиЯндексМаркетФулфилмент();
		
		Если ЕстьАктуальныеНастройки Тогда
			
			ОткрытьФорму(
			"Обработка.ЯндексМаркетВитринаФулфилмент.Форма.ВыгрузкаТоварногоКаталога",
			,,Истина);
			
		Иначе
			
			ОткрытьФорму(
			"Обработка.ЯндексМаркетВитринаФулфилмент.Форма.ПодключениеКСервису",
			,,Истина);
				
		КонецЕсли;


КонецПроцедуры


#КонецОбласти

#Область Сервер

&НаСервере
Функция ЕстьАктуальныеНастройкиЯндексМаркетФулфилмент()
	ЕстьАктуальныеНастройки = Ложь;	
	
	УстановитьПривилегированныйРежим(Истина);
	Организация = ИнтеграцияСЯндексМаркетСервер.ТекущиеДанныеАвторизацииОрганизация();
	
	Если Организация <> Неопределено И ТипЗнч(Организация) = Тип("СправочникСсылка.Организации") Тогда  
		ДанныеАвторизации = ИнтеграцияСЯндексМаркетСервер.ТекущиеДанныеАвторизации(Организация);
		Если ДанныеАвторизации.Свойство("access_token") 
			И ДанныеАвторизации.Свойство("access_token_expires")
			И ДанныеАвторизации.Свойство("refresh_token") Тогда
			
			ЕстьАктуальныеНастройки = Истина;
			
		КонецЕсли;  	
	КонецЕсли;  
	УстановитьПривилегированныйРежим(Ложь);
	
	Возврат ЕстьАктуальныеНастройки;
	
КонецФункции

&НаКлиенте
Процедура ОткрытьПрайсЛист(Команда)
	
	ОткрытьФорму(
	"Обработка.ПрайсЛист.Форма.Форма",
	,,Истина);
		
КонецПроцедуры

#КонецОбласти
